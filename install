# This script is intended to be source'd, not executed

set -e

REPO_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

pip install -v -r requirements.txt

WORK_DIR=`mktemp -d`

cmake -S "${REPO_DIR}/extern/pygsw" -B "${WORK_DIR}" -DCMAKE_BUILD_TYPE=Release
cmake --build "${WORK_DIR}" --target pygsw_wheel --config Release --parallel 4
PYGETM_DIR=`python -c "import pygetm,os;print(os.path.dirname(pygetm.__file__))"`
cp -rv "${WORK_DIR}/dist/pygsw" "${PYGETM_DIR}/pygsw"

rm -rf ${WORK_DIR}/*
cmake -S ${REPO_DIR}/extern/python-otps2 -B ${WORK_DIR} -DCMAKE_BUILD_TYPE=Release
cmake --build ${WORK_DIR} --target install --config Release --parallel 4

rm -rf ${WORK_DIR}
