name: Build and test
on: push
jobs:
   gfortran:
      strategy:
         matrix:
            version: [10]  # [7, 8, 9, 10]
            os: [ubuntu-latest]
            #include:
            #   - version: 6
            #     os: ubuntu-18.04
            #   - version: 8
            #     cmake_args: -DFABM_USE_CONTIGUOUS=OFF
         fail-fast: false
      runs-on: ${{ matrix.os }}
      steps:
      - name: Install compiler
        run: sudo apt-get install python3-numpy python3-wheel python3-netcdf4 python3-mpi4py python3-matplotlib gfortran-${{ matrix.version }}
      - name: Clone
        uses: actions/checkout@v2
        with:
           path: getm
           submodules: recursive
           ssh-key: ${{ secrets.BB_TESTING_SSH }}
      - name: Build and run all test cases
        run: |
          mkdir build
          cd build
          cmake ../python
          make install
          python3 ./tests/test_2d_transport.py
