name: Build and test
on: push
jobs:
   gfortran:
      strategy:
         matrix:
            version: [10]  # [7, 8, 9, 10]
            os: [ubuntu-latest]
            #include:
            #   - version: 6
            #     os: ubuntu-18.04
            #   - version: 8
            #     cmake_args: -DFABM_USE_CONTIGUOUS=OFF
         fail-fast: false
      runs-on: ${{ matrix.os }}
      steps:
      - name: Install compiler
        run: sudo apt-get install gfortran-${{ matrix.version }}
      - name: Save SSH key
        env:
          BB_TESTING_SSH: ${{secrets.BB_TESTING_SSH}}
        run: echo "$BB_TESTING_SSH" > $HOME/id_rsa && chmod 600 $HOME/id_rsa
      - name: Clone
        uses: actions/checkout@v2
        with:
           path: getm
           submodules: recursive
           ssh-key: ~/id_rsa
      - name: Build and run all test cases
        run: |
          mkdir build
          cd build
          cmake ../python
          make install
          python3 ./tests/test_2d_transport.py
